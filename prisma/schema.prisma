generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  clerkUserId   String    @unique // clerk user id
  email         String    @unique
  name          String?
  imageUrl      String?
  industry      String?    // Combined industry-subindustry (e.g., "tech-software-development")
  industryInsight IndustryInsight? @relation(fields: [industry], references: [industry])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Profile fields
  bio           String?
  experience    Int?      // Years of experience

  // Gamification
  points        Int       @default(0)
  level         Int       @default(1)
  badges        String    @default("[]") // JSON string
  streak        Int       @default(0)
  lastActivity  DateTime?
  lastStreakDate DateTime?
  streakStartDate DateTime?

  // Relations
  skills        String    @default("[]") // JSON string
  assessments   Assessment[]
  resumes       Resume[]
  coverLetter   CoverLetter[]
  atsAnalyses   ATSAnalysis[]
  
  // Resume Analytics
  totalResumesCreated   Int @default(0)
  totalResumesSaved     Int @default(0)
  totalResumesDownloaded Int @default(0)
  totalResumesShared    Int @default(0)
  
  // ATS Stats
  totalResumesAnalyzed Int @default(0)
  bestAtsScore         Float?
  lastAtsScore         Float?
}

model Assessment {
  id             String   @id @default(cuid())
  userId         String
  quizScore      Float
  questions      String   @default("[]")
  category       String
  improvementTip String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Resume {
  id            String   @id @default(cuid())
  userId        String
  name          String   @default("My Resume")
  content       String
  mode          String   @default("manual") // manual, ai
  status        String   @default("draft") // draft, saved, downloaded
  atsScore      Float?
  feedback      String?
  downloadCount Int      @default(0)
  shareCount    Int      @default(0)
  shareToken    String?  @unique
  isPublic      Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([shareToken])
}

model CoverLetter {
  id             String   @id @default(cuid())
  userId         String
  content        String
  jobDescription String?
  companyName    String
  jobTitle       String
  status         String   @default("draft")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model IndustryInsight {
  id                String   @id @default(cuid())
  industry          String   @unique
  
  // Users in this industry
  users             User[]
  
  // Salary data
  salaryRanges      String   @default("[]") // JSON string

  // Industry trends
  growthRate        Float    // Industry growth rate
  demandLevel       String   // "High", "Medium", "Low"
  topSkills         String   @default("[]") // JSON string

  // Market conditions
  marketOutlook     String   // "Positive", "Neutral", "Negative"
  keyTrends         String   @default("[]") // JSON string

  // Learning suggestions
  recommendedSkills String   @default("[]") // JSON string
  
  lastUpdated       DateTime @default(now())
  nextUpdate        DateTime // Scheduled update time

  @@index([industry])
}

model ATSAnalysis {
  id                  String    @id @default(cuid())
  userId              String
  user                User      @relation(fields: [userId], references: [id])
  resumeFileName      String
  atsScore            Float
  scoreCategory       String    // Poor / Average / Good / Excellent
  keywordMatchScore   Float
  skillsScore         Float
  formattingScore     Float
  experienceScore     Float
  projectScore        Float
  atsCompatibleScore  Float
  
  // Detailed Analysis
  matchedKeywords     String    @default("[]") // JSON array
  missingKeywords     String    @default("[]") // JSON array
  suggestions         String    @default("[]") // JSON array
  strengths           String    @default("[]") // JSON array
  weaknesses          String    @default("[]") // JSON array
  
  // Insights
  improvementTip      String?
  comparisonData      String?   // JSON string for comparison with previous analyses
  
  // Sharing
  shareToken          String?   @unique // Unique token for shareable links
  isPublic            Boolean   @default(false)
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  @@index([userId])
  @@index([shareToken])
}
